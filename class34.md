# API Deployment

## Django Settings

[Source: Configuring Django Settings: Best Practices](https://djangostars.com/blog/configuring-django-settings-best-practices/)

- Keep settings in env variable
- Write defaults for production config (excluding secret keys/tokens)
- Don't hardcode sensative settings or put in VCS
- Split settings into groups: Django, 3rd-party, project
- Follow naming conventions for custom settings

### Django-environ

- Always store configuration in the environment
- Use `django-environ` to setup a .env file

#### settings.py

```python
import environ


root = environ.Path(__file__) - 3  # get root of the project
env = environ.Env()
environ.Env.read_env()  # reading .env file

SITE_ROOT = root()

DEBUG = env.bool('DEBUG', default=False)
TEMPLATE_DEBUG = DEBUG

DATABASES = {'default': env.db('DATABASE_URL')}

public_root = root.path('public/')
MEDIA_ROOT = public_root('media')
MEDIA_URL = env.str('MEDIA_URL', default='media/')
STATIC_ROOT = public_root('static')
STATIC_URL = env.str('STATIC_URL', default='static/')

SECRET_KEY = env.str('SECRET_KEY')

CACHES = {'default': env.cache('REDIS_CACHE_URL')}
```

#### .env

```text
DEBUG=True
DATABASE_URL=postgres://user:password@db.example.com:5432/production_db?sslmode=require
REDIS_CACHE_URL=redis://user:password@cache.example.com:6379/1
SECRET_KEY=Some-Autogenerated-Secret-Key
```

### Structure

- Restructure settings to be more organized

#### Split by Source

```bash
project/
├── apps/
├── settings/
│   ├── __init__.py
│   ├── djano.py
│   ├── project.py
│   └── third_party.py
└── manage.py
```

### More Granular

```bash
project/
├── apps/
├── settings/
│   ├── project
│   │   ├── __init__.py
│   │   ├── custom_module_foo.py
│   │   ├── custom_module_bar.py
│   │   └── custom_module_xyz.py
│   ├── third_party
│   │   ├── __init__.py
│   │   ├── celery.py
│   │   ├── email.py
│   │   └── rest_framework.py
│   ├── __init__.py
│   └── djano.py
└── manage.py
```

#### __init__.py

```python
from .django import *       # All Django related settings
from .third_party import *  # Celery, Django REST Framework & other 3rd parties
from .project import *      # You custom settings
```

### Naming

- Use meaningful names
- Prefix with project name
- Write descriptions in comments

```python

###### BAD #######
API_SYNC_CRONTAB = env.str('API_SYNC_CRONTAB')

###### GOOD ######

# Run job for getting new tweets.
# Accept string in crontab format. By default: every 30 minutes.
MYAWESOMEPROJECT_TWEETS_API_SYNC_CRONTAB = env.str(
    'MYAWESOMEPROJECT_TWEETS_API_SYNC_CRONTAB', default='30 * * * *'
)
```

## SSH

[Source: How Does SSH Work](https://www.hostinger.com/tutorials/ssh-tutorial-how-does-ssh-work)

- Secure shell: remote admin protocol
- Allows users to remotely control servers
- Built in for Mac and Linux

```bash
ssh {user}@{host}
```

### Encryption

- SSH uses encryption to securely transfer info b/w host and client
- Host: remote server to access
- Client: machine being used to access the host
- SSH uses 3 types of encryption tech

#### Symmetric

- Secret key used for encryption and decryption
- If you have the key, you can decrypt
- AKA Shared Key, Shared Secret
- Used to encrypt entire comms during SSH session
- AES, CAST128, Blowfish

#### Asymmetric

- Two separate keys for encryption and decryption
- Public key ad private key (public-private key pair)
- Public shared with all parties
- Message can only be decrypted with private key
- In SSH, used during key exchange algo for symmetric encryption

#### Hashing

- One-way hash never intended to be decrypted
- SSH uses this to verify authenticity of messages (HMACS)
